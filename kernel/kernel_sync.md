---
author: lunar
date: Mon 26 Oct 2020 09:04:32 PM CST
location: Shanghai
---

## 内核同步介绍

用户空间之所以需要同步，是因为用户程序会被调度程序调度抢占和重新调度。由于用户进程可能在任何时刻被抢占，而调度程序完全可能选择另一个高优先级的进程到处理器上运行，所以就似的一个程序正处于临界区时，被非自愿地抢占了，如果新调度的程序随后也进入了同一个临界区，前后两个进程就产生了竞争。

在linux内核中，会导致并发bug的原因不止是多个线程共同工作，包括：
- 中断——中断可能随时打断当前正在执行的代码
- 软中断和tasklet——内核可以在任何时刻唤醒或调度软中断和tasklet，
- 内核抢占 —— 内核中执行的任务也可能被另一个任务抢占
- 睡眠与用户空间同步 —— 在内核执行的进程可能会睡眠，导致唤醒调度程序。
- 对称多处理(Symmetrical Multi-Processing, SMP) —— 多个处理器可能同时执行一段代码

并发程序设计最大的难点在于如何识别出真正需要共享的数据和相应的临界区。


